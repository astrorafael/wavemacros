<?xml version="1.0" encoding="UTF-8"?>

<MACRO name="Duplicate selected range in clip" script="// This macro inserts a leading clip with some clicks and&#10;// pads the rest of tracks with an empty space, then renders all clips per track&#10;// Usage: &#10;//   1. Select a range with the mouse.&#10;//   2. then select the clip containing the click track. &#10;//   3. execute the macro.&#10;&#10;function pasteClip(clip, start, end)&#10;{&#10;    Tracktion.log(&quot;Pasting clip &quot; + clip + &quot; starting at &quot; + start);&#10;    Tracktion.deselectAll();&#10;    Tracktion.addObjectsToSelection(clip);&#10;    Tracktion.copy();&#10;    Tracktion.insertSpaceIntoEdit (start, end - start); // for all tracks&#10;    Tracktion.paste();&#10;    Tracktion.setPosition ('cursor', start);&#10;    Tracktion.moveStartOfSelectedClipsToCursor();&#10;    var trclips = Tracktion.getClipsFromTracks (Tracktion.getTrackFromSelectedObject());&#10;    var seclips = Tracktion.getSelectedEditElements ('clip');&#10;    Tracktion.log(&quot;After pasting, there are &quot; + seclips.length + &quot; selected clips out of &quot; + trclips.length);&#10;}&#10;&#10;function splitMarkedRegion(old_method)&#10;{&#10;    var start = Tracktion.getPosition ('markIn');&#10;    var end   = Tracktion.getPosition ('markOut');&#10;    if ( ! old_method) {&#10;        Tracktion.log(&quot;Using API split method&quot;);&#10;        Tracktion.splitMarkedRegion();&#10;    } else {&#10;        Tracktion.log(&quot;Using old split method&quot;);&#10;        Tracktion.setPosition ('cursor', start);&#10;        Tracktion.splitClips();&#10;        Tracktion.setPosition ('cursor', end);&#10;        Tracktion.splitClips();&#10;        Tracktion.log(&quot;Selected Region: start = &quot; + start + &quot;, end = &quot; + end);&#10;    }&#10;    return [start, end];&#10;}&#10;&#10;function duplicateSelectedRegion()&#10;{&#10;    var clips   = Tracktion.getSelectedEditElements ('clip');&#10;    if (clips.length == 0) {&#10;        Tracktion.showMessage('No clips selected');&#10;        return;&#10;    }&#10;    Tracktion.log(&quot;========================================&quot;);&#10;    var clickTrack = Tracktion.getTrackFromSelectedObject();&#10;    var clickTrackName = Tracktion.getName(clickTrack);&#10;    var marks = splitMarkedRegion(true);&#10;    var start = marks[0];&#10;    var end   = marks[1];&#10;    clips = Tracktion.getClipsFromTracks (clickTrack);&#10;    Tracktion.log(&quot;Click Track has &quot; + clips.length + &quot; clips selected.&quot;);&#10;    var index = 0;&#10;    if (clips.length == 3) {&#10;        index = 1;&#10;    }&#10;    pasteClip(clips[index], start, end);&#10;}&#10;&#10;duplicateSelectedRegion();&#10;"/>
