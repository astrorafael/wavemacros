<?xml version="1.0" encoding="UTF-8"?>

<MACRO name="Extract every 3rd clip transients" script="// ---------------------------------------------------&#10;// Decimates a click track pulses every 'beatsPerBar'&#10;// User must select the clip to be decimated.&#10;// Only one clip must be selected.&#10;// --------------------------------------------------&#10;&#10;var decimationFactor = 3;     // usually 4 in 99% of the use cases&#10;var offset           = 0;     // from 0 to decimationFactor-1&#10;var inverted         = false; // inverted decimation condition&#10;&#10;function removeSilence(track)&#10;{&#10;    Tracktion.removeSilence(true);&#10;    return Tracktion.getClipsFromTracks (track);&#10;}&#10;&#10;function mergeClips(track, clips) {&#10;    Tracktion.deselectAll();&#10;    Tracktion.addObjectsToSelection(clips);&#10;    Tracktion.mergeSelectedClips();&#10;    return Tracktion.getClipsFromTracks (track);&#10;}&#10;&#10;function decimateClips(track, clips, N, offset, inverted) {&#10;    Tracktion.deselectAll();&#10;    for (var c = 0; c &lt; clips.length; ++c) {&#10;        var modulus = (c + N - offset) % N;&#10;        if ( ! inverted &amp;&amp; modulus != 0) {&#10;            Tracktion.addObjectsToSelection (clips[c]);&#10;        } else if (inverted &amp;&amp; modulus == 0) {&#10;            Tracktion.addObjectsToSelection (clips[c]);&#10;        }&#10;    }&#10;    Tracktion.deleteSelected();&#10;    return Tracktion.getClipsFromTracks (track);&#10;}   &#10;&#10;&#10;function decimateClipTransientsEvery(N, offset)&#10;{&#10;    var clips = Tracktion.getSelectedEditElements ('clip');&#10;    var track = Tracktion.getTrackFromSelectedObject();&#10;&#10;    if (clips === null) {&#10;        Tracktion.showMessage('No clip selected');&#10;        return;&#10;    }&#10;    if (clips.length &gt; 1) {&#10;        Tracktion.showMessage('Too many clips selected');&#10;        return false;&#10;    }&#10;    var track = Tracktion.getTrackFromSelectedObject();&#10;    var name = (inverted ? 'upbeats' : 'downbeats');&#10;    Tracktion.setName (track, name);   // name track depending on condition&#10;    clips = removeSilence(track);&#10;    clips = Tracktion.getClipsFromTracks (track);&#10;    clips = decimateClips(track, clips, N, offset, inverted);&#10;    clips = mergeClips(track, clips);&#10;    Tracktion.setName (clips[0], name);   // final clip name&#10;}&#10;&#10;decimateClipTransientsEvery(decimationFactor, offset, inverted);&#10;&#10;"/>
