<?xml version="1.0" encoding="UTF-8"?>

<MACRO name="Duplicate leading click track bar" script="// This macro inserts a leading clip with some clicks and&#10;// pads the rest of tracks with an empty space, then renders all clips per track&#10;// Usage: &#10;// 1. Select a range &#10;// 2. then select the clip containing the click track &#10;// 3. execute the macro&#10;&#10;&#10;function pasteClip(clip, start, end)&#10;{&#10;    Tracktion.log(&quot;Pasting clip &quot; + clip + &quot; starting at &quot; + start);&#10;    Tracktion.deselectAll();&#10;    Tracktion.addObjectsToSelection(clip);&#10;    Tracktion.copy();&#10;    Tracktion.insertSpaceIntoEdit (start, end - start);&#10;    Tracktion.paste();&#10;    Tracktion.setPosition ('cursor', start);&#10;    Tracktion.moveStartOfSelectedClipsToCursor();&#10;    var trclips = Tracktion.getClipsFromTracks (Tracktion.getTrackFromSelectedObject());&#10;    var seclips = Tracktion.getSelectedEditElements ('clip');&#10;    Tracktion.log(&quot;After pasting, there are &quot; + seclips.length + &quot; selected clips out of &quot; + trclips.length);&#10;}&#10;&#10;function padOtherTracksThan(trackName, start)&#10;{&#10;    var tracks = Tracktion.getEditElements ('track');&#10;    var name = null;&#10;    for(var t = 0; t &lt; tracks.length; ++t ) {&#10;        //Tracktion.log(&quot;Comparing Track[&quot; + t + &quot;] name  (&quot; + name + &quot;) con track name (&quot; + trackName + &quot;)&quot;);&#10;        name = Tracktion.getName(tracks[t]);&#10;        if (name !== trackName) {&#10;            Tracktion.deselectAll();&#10;            Tracktion.addObjectsToSelection(tracks[t]);&#10;            Tracktion.setPosition ('cursor', start);&#10;            Tracktion.insertClip ('wave');&#10;        }&#10;    }&#10;}&#10;&#10;function logTrack(track, i, clips)&#10;{&#10;    name = Tracktion.getName(track);&#10;    Tracktion.log(&quot;Track[&quot; + i + &quot;] = &quot; + name + &quot; has &quot; + clips.length + &quot; clips&quot;);&#10;}&#10;&#10;function mergeAllClips()&#10;{&#10;    var tracks = Tracktion.getEditElements ('track');&#10;    Tracktion.deselectAll();&#10;    Tracktion.log(&quot;found &quot; + tracks.length + &quot; tracks&quot;);&#10;    for(var t = 0; t &lt; tracks.length; ++t ) {&#10;        var clips = Tracktion.getClipsFromTracks (tracks[t]);&#10;        logTrack(tracks[t], t, clips);&#10;        for(var c = 0; c &lt; clips.length; ++c ) {&#10;            Tracktion.addObjectsToSelection(clips[c]);&#10;        } &#10;    }&#10;    // Even though we have selected all clips, merge processing is per track&#10;    Tracktion.mergeSelectedClips (true);&#10;}&#10;&#10;function splitMarkedRegion(old_method)&#10;{&#10;    var start = Tracktion.getPosition ('markIn');&#10;    var end   = Tracktion.getPosition ('markOut');&#10;    if ( ! old_method) {&#10;        Tracktion.log(&quot;Using API split method&quot;);&#10;        Tracktion.splitMarkedRegion();&#10;    } else {&#10;        Tracktion.log(&quot;Using old split method&quot;);&#10;        Tracktion.setPosition ('cursor', start);&#10;        Tracktion.splitClips();&#10;        Tracktion.setPosition ('cursor', end);&#10;        Tracktion.splitClips();&#10;        Tracktion.log(&quot;Selected Region: start = &quot; + start + &quot;, end = &quot; + end);&#10;    }&#10;    return [start, end];&#10;}&#10;&#10;function padding()&#10;{&#10;    var clips   = Tracktion.getSelectedEditElements ('clip');&#10;    if (clips.length == 0) {&#10;        Tracktion.showMessage('No clips selected');&#10;        return;&#10;    }&#10;    Tracktion.log(&quot;========================================&quot;);&#10;    var clickTrack = Tracktion.getTrackFromSelectedObject();&#10;    var clickTrackName = Tracktion.getName(clickTrack);&#10;    var marks = splitMarkedRegion(true);&#10;    var start = marks[0];&#10;    var end   = marks[1];&#10;    clips = Tracktion.getClipsFromTracks (clickTrack);&#10;    Tracktion.log(&quot;Click Track has &quot; + clips.length + &quot; clips selected.&quot;);&#10;    var index = 0;&#10;    if (clips.length == 3) {&#10;        index = 1;&#10;    }&#10;    pasteClip(clips[index], start, end);&#10;    padOtherTracksThan(clickTrackName, start);&#10;    mergeAllClips();&#10;}&#10;padding();&#10;"/>
